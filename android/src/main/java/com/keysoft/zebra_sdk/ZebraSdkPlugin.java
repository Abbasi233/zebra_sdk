package com.keysoft.zebra_sdk;

import android.os.Looper;

import androidx.annotation.NonNull;
import java.util.HashMap;
import java.util.Map;

import io.flutter.embedding.engine.plugins.FlutterPlugin;
import io.flutter.plugin.common.MethodCall;
import io.flutter.plugin.common.MethodChannel;
import io.flutter.plugin.common.MethodChannel.MethodCallHandler;
import io.flutter.plugin.common.MethodChannel.Result;

import com.zebra.sdk.comm.*;
import com.zebra.sdk.printer.*;
import com.zebra.sdk.printer.internal.ZebraPrinterZpl;

/** ZebraSdkPlugin */
public class ZebraSdkPlugin implements FlutterPlugin, MethodCallHandler {
  /// The MethodChannel that will the communication between Flutter and native Android
  ///
  /// This local reference serves to register the plugin with the Flutter Engine and unregister it
  /// when the Flutter Engine is detached from the Activity
  private MethodChannel channel;

  @Override
  public void onAttachedToEngine(@NonNull FlutterPluginBinding flutterPluginBinding) {
    channel = new MethodChannel(flutterPluginBinding.getBinaryMessenger(), "zebra_sdk");
    channel.setMethodCallHandler(this);
  }

  @Override
  public void onMethodCall(@NonNull MethodCall call, @NonNull Result result) {
    System.out.println(call.method);
    if (call.method.equals("print")) {
      Map<String, Object> methodResult = print(call.argument("btAddr"), call.argument("content"), call.argument("labelLength"));
      result.success(methodResult);
    } else {
      result.notImplemented();
    }
  }

  private Map<String, Object> print(final String btAddr, final String content, final String labelLength) {
//    new Thread(new Runnable() {
//      public void run() {
        Map<String, Object> returnValue = new HashMap<String, Object>();
        try {

          Connection connection = new BluetoothConnectionInsecure(btAddr);
//            Looper.prepare();
            connection.open();

            ZebraPrinter zPrinterIns = new ZebraPrinterZpl(connection);
            zPrinterIns.sendCommand("! U1 setvar \"device.languages\" \"zpl\"\r\n");
    //        Thread.sleep(500);

            String gibLogo = "^FO200,50^GFA,5000,5000,25,gH03JFC,g03NFC,Y03PFC,X07IFK01IFC,W03FFCN03FFC,V01FF8P01FF8,V0FFCR03FE,U03FCM03L03FC,U0FEL03C7M0FF,T07F8L03C7I0CI01FE,S01FCM03CFI0CCI03F,S07FN03CF1F0CCJ0FE,S0FCK03E036F1F9CK03F,R03FK0677037B0198CK0FC,R0FCJ04663037B1F99D8J03F,Q03FK0E67F037B3BI984J0F8,Q07EK06670033B31I98EJ07E,P01F8K03673033B3FJ9C6I01F,P03EI01E03E3FJ01FBBI9F8I07C,P07CI03F01E1CL0130F198I03E,O01FJ06300EO010E3980201F,O03EJ06ET0E3F807007C,O07C001E798R01C3180FC03E,O0FI03F738R0783A00CE00F,N01E018E33FS0301F01C70078,N07C018639EX03E3003E,N0F800671CY03FF001F,M01EI0630CY073EI0F8,M03C002738g0E18I07C,M07800739Cg079C4001E,M0FI0F188g01FCF001F,L01E003F0CgH0F8380078,L03C00330CgH0339C007C,L078I037gJ07FC601C,L07001C3EgJ0638E01E,L0F003E3CgJ0371C00F,K01E007F78gJ01E380078,K03C006FBgL0E7A003C,K0781869CgL04FF801E,K0F01C198gL01FCI0E,K0E00E1BP01RF8I0198I0F,J01E0071EP03QFEK01860078,J03C007CCP0RF8K0387003C,J038187EP01QFEL0133801C,J0781CCFP03QFCL0179801E,J0F00F82P0RFN06F800F,J0E0078P01QFEN0638007,I01C003CP03QF8N03FI078,I03C001EP07QFO01E38038,I038I07P0QFCP0C7801C,I078I02O01QF8P01FC01E,I07T03QFQ03C600E,I0ET07PFCQ030600F,I0ET0QF8S0E007,001CS01QFS03C1078,001CI06O01PFES0787038,00381E06O03PF8S0E1F01C,00383C02O07PFU07C01C,0070302P0PFET01F001E,0070607O01PFCJ01CN03CI0E,00E0603O01PF8J0FF8M010600F,00E0703O03PFJ01FFCN01E007,01E0383O07OFEJ07FFEN078007,01C03E7O07OFCJ0JFN0EI038,01C00FEO0PF8J0JFO079038,0380078N01PF8I01JF8M01FD01C,038R01PFJ03JF8M01CD81C,0382Q03OFEJ03JF8M098481C,070301O03OFCJ07JF8M0D8600E,0706038N07OF8J07JF8M099E00E,070601O07OFK07JF8M0CFC00E,0E07CP0PFK07JF8M0FFI07,0E0FF8N01OFEK0KF8M0781007,0E0C7EN01OFCK0KF8O0F807,1C0C0EN01OF8K0KF8N07F007,1C08P03OF8K0KF8N07800381CR03OFL0KFS0381CR07NFEL0KFS03818R07NFEL07IFES03838R0OFCL07IFES01C38R0OFCL07IFCS01C38Q01OF8L03IF8S01C38Q01OFM01IFT01C78Q01OFM01FFET01C7R03NFEN07F8T01C7R03NFEN01EV0E7R03NFCgL0E7R07NFCgL0E7R07NF807OFU0E:7R07NF807NFEU0E6R0OF00OFEU0E:ER0NFE00OFEU06EQ01NFE01OFEU06EQ01NFE01OFCU06EQ01NFC01OFCU06EQ01NFC03OFCU07EQ01NF803OFCU07:EQ03NF8K01KF8U07EQ03NF8K03KF8U07EQ03NFL03KF8U07EQ03NFL03KF8U06:EQ03NFL07KF8U066Q03MFEL07KFV066Q07MFEL07KFV0E:7Q07MFEL07KFV0E7Q07MFEL0KFEV0E::::7Q07MFEK01KFEU01C38P07MFCK01KFCU01C:::38P03MFEK03KFCU01818P03MFEK03KF8U0381CP03MFEK03KF8U038:1CP03MFEK07KF8U0381EP03MFEK07KF8U07,0EP03MFEK07KFV07,0EP01MFEK07KFV07,0EP01MFEK07KFV0E,07P01NFK0LFV0E,:07P01NFK0KFEU01E,038P0NFK0KFEU01C,038P0NF8J0KFEU01C,038P0NF8I01KFEU038,01CP0NF8I01KFEU038,01CP07MF8I01KFEU038,01EP07MFCI01KFCU07,00EP07MFCI01KFCU07,00EP03MFEI03KFCU0E,007P03MFEI03KFCU0E,007P01MFEI03KF8T01E,0038O01NFI03KF8T01C,0038O01NFI07KF8T03C,001CP0NF8007KF8P0CI038,001EI01FK0NF8007KF8O01EI078,I0EI07F8J07MFC007KF8O0478007,I0FI0F18J07MFC007KFO0343C00F,I07I0E18J03MFE00LFO0260C00E,I07801C98J03NF00LFO0EFI01E,I03801DD8J01NF00LFO01B8001C,I01C00CEK01NF80LFO01938038,I01E00FEL0NFC0KFEO01F78078,J0E0038L07MFE1KFEO01EF807,J0F0030FgP087D80E,J078001F8gN01C3B01E,J038003D8gM010E1E01C,J03C003784gL03870E038,J01E00338EgL01C380078,K0F003D1CgM0E1C00F,K07001E38CgL070801E,K078I078EgK0438001C,K03CI071CgK0F1C003C,K01EI0E38gJ01F8C0078,L0F001C7gK03B8I0F,L078I0E3gJ039C001E,L03C001C7802gG01CC003C,L01E001C7C02g071CI078,L01EI08F808g0F8EI0F,M0F8001C00CY019C6001E,M07C001801CY01BCI03C,M03EI08018W03186EI078,M01FK03808U0310EEI0F,N078J0709CU01B078001E,N03CJ073F8U01B87I03C,N01EJ0E3B8T038FEJ078,O0F8I0E738T0F8EFI01F,O07CI04631EO02I0C862I03E,O03EJ0671BN03F87CFE7J078,P0F8I07E139EJ0607B8FC7E2I01F,P07CI03E7F1E380060318CE06J03E,P03FJ04771C7C3C603783E7CJ0F8,Q0F8J07738E67C603FC6638I01F,Q07EJ03E30FE606039C6E0EI07E,Q01FK0630FE7C6038E7E04001F8,R0FCK030C43E601BC3K07E,R03FM07C46601F8L0FC,S0FCL0387C601CL03F,S03FN0386N01FC,T0FEX07F,T03F8V01FC,U0FFV0FF,U03FET07FC,V07FCR07FE,W0FFCP03FF,W01FFEN0IF8,X03IFCJ03IFC,Y03PF8,g01NF8,gI07FFE,^FS";

            String aysanLogo = "^FO150,250^GFA,11400,11400,38,,::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::gM01M01JF,gQ0RF8,gO0WF,gL01MFM0LFC8,gK07JFES01JFC,gI01JFEW03IFE008,gH03IFECg03IF,gG03JFgI01IF8,g07IFC02gI01IF,Y03IFQ01J0A1808002I400IF8,X03IFJ04I01036162600208004404I01IF,W01IF8J040C068014003040808051811I01FFE,V03IF00EI040C24001400140034002I0200301IF,V0IFCE0JFC0F7A003E007E007E0034006007F0IFE,U07PF80CCA00FF80FF80FF81FA00DOFC,T03QF80IF83FF83FF83FF83FF006PF,T0RF40IF91FF91FF81FF81FF01QFC,S01RFC03BF98FF18FF18FF18FF31RF08,S0TF003FBC7F3CFF3CFF3DFF7CRFC,R01TF807gQFE,R03hOF,R07hOF9,R07hOFC,R0hPFE,:R0PF00RFE03KF00MF07FF9JFE,R0OF8I07F003FC00FEI07IFJ0FFC01C00FE0JFE,R0NFEJ01F003FC01F8I01FFCJ03F8038007C07IFE,R0NF8J01F001FC01FK0FF8J01F803I03D07IFE,R0NFL0F801F801EK07FL0F8K01D17IFE,R0NFL0F801F803EK07FL0F8K01CC7IFE,R0NFL07801F803C007003EL0F8L0ECJFE,R0MFE003E007C00F003C00F803E007C00F8L0E1JFE,Q01MFE007E007C00F007C00F803E007C0078L0LFE,Q01QFE007C00F007C003MFC0078007800LFE,Q01QF8007E00F007CI03LF8007800FC00LFE,Q01OFEJ07E00600FCJ07IFEJ07800FC00LFE,Q01NFEK07E00600FEJ01FFEK07801FC00LFE,Q01NF8K07F00600FEK0FF8K07801FC00LFE,Q01NFL07F00401FFK03EL07801FC00LFE,Q01MFEL07F00401FFCJ03EL07801FC00LFE,Q01MFCI02007F8I03IFJ01CI04007801FC00LFE,Q01MFC003E007F8I03JFI01C003C007801FC00LFE,Q01MFC00FE007F8I03KF001800FC007801FC00LFE,Q01MFC00FE007FCI03F801F801800FC007801FC00LFE,Q01MFC00FC007FCI07F801F801800FC007801FC00LFE,Q01MFC0078007FCI07FC00F001800F8007801FC00LFE,Q01MFCL07FEI07FCK038L07801FC00LFE,Q01MFCL07FEI07FCK03CL07801FC00LFE,Q01MFEL07FEI0FFEK07CL07801FC00LFE,Q01MFEL07FFI0IFK0FEI02007801FC00LFE,Q01NFI07003FF001IFCI03FFI06003801FC00LFE,Q01NFC01F007FF001JFI0IFC01F007C81FC00LFE,Q01VFE001gPFE,Q01UFEI03gPFE,:Q01UFEI07gPFE,Q05UFEI07gPFE,Q01UFEI0gNFC7FE,Q01UFE001SF03SFEFFE,R0UFE007OFE01FI03NFBKFE,R0gMF8I03CI01SFE,R0gLF8K0F18K0JFCIF7FC,R07gGFEN03FF8N01CFDF6FC,R07YFCK024009FFEO01FE9FEF8,R03XFCL0CI0DCR09BEIF8,R01PF8J0FFM07CX07EFF1,R08NFCFCCK08L07FN03008L03C7E,R047PFJ0EN0FFM077A18J0F01DF808,S01OF08K038J07FCM077388J0F019F81,T03NF8K0CK0FF8N07FL01F9FBF,W03KF08M0E01FCO0FECK01JFE,V01KFE08I03R0166O039JF8,V03KFE08O03L07F8I04K0FDIFE,V07LFC04T01FK0F3C0607DIF8,U01MFI0F8V03IFBF7F7E1IF,U07MF801g0JF7FFC3FFC,U0OFS078N07OF8,T03IFL018P01IF8M01MFE,T07FFP07P0F87EM07LFC,T0F8g0OFB8C7MF,S038T0380100100WFC,gQ0C01CI0WF,gQ01L03UFC,gY07TF,gY03SFC,gT08J03SF,gY07RF8,gU03I07QFE,gV070037PF,gW0EE703NF,gX078C7MF8,gY03F8FF7IF,hG0KFC,hI0C,,:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::^FS";

            zPrinterIns.sendCommand("^XA" +
                    "^POI" +
                    "^LL" + labelLength +
                    "^CI28" +
                    "^CF0,20" +
                    // gibLogo +
                    // "^FB578,,,C,0^FO0,280^FDe-Ä°rsaliye\\&^FS" +
                    // aysanLogo +
                    content +
                    "^XZ");

    //        Thread.sleep(500);
            connection.close();
            returnValue.put("result", true);
//            Looper.myLooper().quit();
          } catch (Exception e) {
        e.printStackTrace();
        returnValue.put("result", false);
        returnValue.put("errorMessage", e.getMessage());
      }
//      }
//    }).start();
    return returnValue;
  }

  @Override
  public void onDetachedFromEngine(@NonNull FlutterPluginBinding binding) {
    channel.setMethodCallHandler(null);
  }
}
